#!/bin/sh

if [ -f makefile ]
then
    echo "Configuration done. Run 'make'."
    exit 0
fi

name=retrosmart-icon-theme
path=$name/scalable
suf='.svg'

icons=""
preview=""
links=""

for i in src/*.links
do
    source="src/$(basename $i .links).svg"
    if [ -f "$source" ]
    then
        links="$links $i"
    else
        echo "File $source not found"
        exit 1
    fi
done

for i in $(cat src/preview.list)
do
    source="src/$i"
    if [ -f "$source" ]
        then
            preview="$preview $source"
        else
            echo "File $source not found"
            exit 1
        fi
done

makefile() {

echo "include makefile.in"

echo "$name:"
echo "\tmkdir -p $path"

echo "$name/index.theme: $name"
echo "\tcp src/index.theme $name/"

for i in $links
do
    source="src/$(basename "$i" .links).svg"
    bsource="$(basename "$source")"
    for j in $(cat $i)
    do
        icons="$icons $path/$j"
        echo "$path/$j: $name/index.theme"
        if [ "$bsource" = "$j" ]
        then
            echo "\tcp $source $path/$j"
        else
            echo "\tcd $path && ln -s $bsource $j"
        fi
    done
done

echo "icons: $icons"

echo "preview.png: $preview"
echo "\tmontage -verbose -resize 64 -geometry +16+16 -tile 9x6 $preview preview.png"

}

makefile > makefile && echo "Configuration done. Run 'make'." || echo "Configuration failed. Please debug."
